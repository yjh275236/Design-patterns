---
alwaysApply: false
---
# Xcode 日志捕获

## 触发方式
- `@xcode-log.mdc`
- "查看日志"、"捕获日志"

## 核心价值
让 AI 看到应用的 `print()` 和 `NSLog()` 输出，诊断启动问题和运行错误

## 执行流程

### 标准日志捕获
```javascript
// 1. 获取运行中的模拟器
list_sims() → 找 state: "Booted" → 获取 UUID

// 2. 捕获日志（推荐使用 launch_app_logs_sim）
launch_app_logs_sim({
  simulatorUuid: "[UUID]",
  bundleId: "com.example.app"
})
→ 返回 sessionId

// 3. 等待应用启动和日志产生
sleep(3-5)

// 4. 停止捕获并获取日志
stop_device_log_cap({ logSessionId: "[sessionId]" })
```

### 备用方案（如果 launch_app_logs_sim 失败）
```javascript
// 方案 1: 使用 start_device_log_cap（需要设备 UUID）
start_device_log_cap({
  deviceId: "[设备UUID]",
  bundleId: "com.example.app"
})

// 方案 2: 直接在 Xcode 控制台查看
// 提示用户：在 Xcode 中查看 Debug Console
```

## 捕获内容
- `print()` 输出
- `NSLog()` 输出
- 系统日志
- 崩溃信息
- 警告和错误

## 使用场景

| 场景 | 添加日志位置 | 作用 |
|------|------------|------|
| 调试启动 | AppDelegate.didFinishLaunching | 看应用是否启动 |
| 调试窗口创建 | SceneDelegate/AppDelegate | 看窗口是否创建 |
| 调试视图加载 | viewDidLoad/viewWillAppear | 看视图是否加载 |
| 调试逻辑 | 函数入口/分支 | 看执行路径 |
| 调试网络 | 请求前/成功/失败 | 看请求结果 |
| 调试数据 | 数据获取/处理 | 看数据内容 |
| 调试崩溃 | 关键操作前 | 看崩溃原因 |

## 日志最佳实践

### 1. Emoji 标记（关键方法使用）
```swift
print("✅ AppDelegate: didFinishLaunching called")
print("✅ SceneDelegate: Window created")
print("✅ ViewController: viewDidLoad called")
print("❌ Error: Failed to create window")
print("⚠️ Warning: Scene not available")
print("🔍 Debug: Checking window state")
print("📡 Network: Request started")
print("💾 Data: Loading from cache")
```

### 2. 记录关键数据和状态
```swift
print("AppDelegate: Window frame: \(window?.frame ?? .zero)")
print("AppDelegate: Root VC: \(window?.rootViewController?.description ?? "nil")")
print("ViewController: View frame: \(view.frame)")
print("ViewController: Total items: \(items.count)")
```

### 3. 记录执行路径（启动流程）
```swift
// AppDelegate.swift
func application(_ application: UIApplication, didFinishLaunchingWithOptions...) -> Bool {
    print("✅ AppDelegate: didFinishLaunchingWithOptions called")
    // ... 窗口创建代码 ...
    print("✅ AppDelegate: Window created and made key visible")
    return true
}

// ViewController.swift
override func viewDidLoad() {
    super.viewDidLoad()
    print("✅ ViewController: viewDidLoad called")
    print("   View frame: \(view.frame)")
    // ... 其他代码 ...
}
```

## 诊断常见问题

### 问题 1: 日志捕获失败
```
如果 stop_device_log_cap 返回 "session not found":
1. 重新启动应用
2. 使用 launch_app_logs_sim 而不是 start_device_log_cap
3. 或提示用户在 Xcode 控制台查看
```

### 问题 2: 无日志输出
```
可能原因：
1. 应用未启动 → 检查进程
2. print 语句未执行 → 检查代码路径
3. 日志被过滤 → 检查 Xcode 控制台过滤设置

解决方案：
1. 在 AppDelegate.didFinishLaunching 最早位置添加 print
2. 确保应用真正运行（describe_ui 检查）
3. 检查 Xcode Debug Console
```

### 问题 3: 应用黑屏但没有日志
```
诊断步骤：
1. describe_ui 检查应用是否运行
2. 如果有 Application 节点但没有 children → UI 未加载
3. 添加更多 print 在关键位置：
   - AppDelegate: didFinishLaunching
   - SceneDelegate: willConnectTo
   - ViewController: viewDidLoad/viewWillAppear
```

## 调试流程

### 标准流程
```
1. 添加 print() 在关键位置
2. 构建运行（@xcode-build）
3. 捕获日志（@xcode-log）
4. AI 分析日志并提供建议
5. **重要**：问题解决后立即删除所有调试 print() 语句
```

### 调试代码清理原则

**核心规则：用完即删**

1. **调试完成后必须清理**
   - 所有调试用的 `print()` 语句
   - 测试用的代码和注释
   - 临时的验证逻辑

2. **保留的情况**
   - 错误处理的 `print("Error: ...")`（有助于生产环境调试）
   - 设计模式演示中的输出（用于说明模式功能）

3. **清理方法**
   ```bash
   # 搜索所有调试 print
   grep -r "print(" | grep "✅\|⚠️\|🔍\|调试\|Debug"
   
   # 删除后验证
   grep -r "print(" --include="*.swift"
   ```

4. **验证清单**
   - [ ] AppDelegate/SceneDelegate 中无调试 print
   - [ ] ViewController 生命周期方法中无调试 print
   - [ ] 无测试用的代码或注释
   - [ ] 仅保留必要的错误处理输出

### 启动问题诊断流程
```
1. 构建并运行
2. 立即捕获启动日志
3. 检查关键日志：
   ✅ AppDelegate: didFinishLaunching
   ✅ SceneDelegate: Window created（如果使用 Scene）
   ✅ ViewController: viewDidLoad
4. 如果缺少某个日志，说明该步骤未执行
```

## 启动问题诊断

### 问题: 应用未启动或启动失败

**判断标准：**
- describe_ui() 完全没有 Application 节点
- 应用构建成功但无法运行

**诊断流程：**
```
1. 捕获启动日志
   launch_app_logs_sim() → 查看错误/崩溃信息

2. 检查关键日志位置：
   - AppDelegate.didFinishLaunching
   - SceneDelegate（如果使用 Scene）
   - ViewController 生命周期方法

3. 如果缺失某个日志，说明该步骤未执行 → 检查对应代码

4. 检查编译错误
   read_lints()
```

### 通用诊断原则

1. **先确认状态**：describe_ui() 确认应用是否运行
2. **捕获日志**：启动时立即捕获日志
3. **检查关键路径**：关键方法的 print 是否执行
4. **分析日志**：根据日志定位问题代码
5. **备用方案**：如果 MCP 日志工具失败，提示查看 Xcode Debug Console

**注意：**
- UI 问题（黑屏但应用运行）使用 @xcode-ui.mdc
- 构建问题使用 @xcode-build.mdc

## 核心规则
1. 自动检测模拟器和应用
2. 启动问题时自动捕获日志并分析
3. 如果日志捕获失败，提示用户在 Xcode 控制台查看
4. 完整显示日志内容，AI 分析日志并提供建议
5. **重要**：启动问题一定要检查 AppDelegate 和 ViewController 的启动日志
6. **注意**：UI 相关问题请使用 @xcode-ui.mdc，构建问题请使用 @xcode-build.mdc

## 项目配置
- Bundle ID: `com.daiwo.zydd`（或当前项目）
- 默认模拟器: `iPhone SE (3rd generation)`

## 注意事项
- `launch_app_logs_sim` 会重启应用，适合启动问题诊断
- `start_device_log_cap` 不重启应用，适合运行时日志捕获
- 如果 MCP 日志捕获工具失败，总是提示用户查看 Xcode Debug Console
